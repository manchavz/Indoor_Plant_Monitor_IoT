# Indoor_Plant_Monitor_IoT

The goal of the project was to design, develop, and implement an indoor plant monitor system for individuals who would like to grow a plant inside their home but do not have the time to take care of it. 

The system uses an array of sensors to gather data of the plant such as temperature, soil moisture level, and sunlight which is aggregated by the ESP32 microcontroller. The ESP32 counts with a wifi module used to push the telemetry into the Google Cloud Platform via the MQTT protocol. In the cloud, the information is stored and processed compared against ceratain threshold values that indicate if the plant is doing well or not. Lastly, a report about the plant's status is delivered through mail to the user of the service.

# Video
[![Video](https://i.ibb.co/M7dFbQw/video-preview.png)](https://drive.google.com/file/d/1k6RktlvB6GGy4GBJqHew5WgdUiIqBpmk/view "Video")

## Google Cloud Platform System Configuration
* Register a device to Google IoT Core service
    * Create a Registry
    * Enter custom registry ID name
    * Select (your) corresponding region
    * Select MQTT as the communication protocol
    * Under _Default Telemetry Topic_ select _Create Topic_
        * Name the topic something descriptive and easy to remember
    * Select the same topic under _Device State Topic_
    * For "Stackdriver Logging" select _None_
    * Finally, click _Create_
* Create a Subscription
    * Click on the topic path in the newly created registry
    * Then, click _Create Subscription_
    * Enter a subscription name of your choosing
    * Keep the _default values_ for the remaining fields and click _Create_
* Create private key, public key, and CA certificate
    * Navigate and open a _Cloud Shell_ by clicking the terminal symbol
    * Enter the following commands to generate an ES256 key with self-signed X509 certificate:
        * _openssl ecparam -genkey -name prime256v1 -noout -out ec_private.pem_
        * _openssl ec -on ec_private.pem -pubout -out ec_public.pem_
        * _openssl ecparam -genkey -name prime256v1 -noout -out ec_private.pem_
        * _openssl req -x509 -new -key ec_private.pem -days 1000000 -out ec_cert.perm -subj "/CN=unused"_
        * (All the files generated by the previous commands are store in your virtual root directory)
* Create a device
    * Navigate to Cloud Console >> IoT Core >> `custom registry ID name` >> Devices >> Create Device
    * In the menu enter a _device ID_ of your choice following the restrictions imposed
    * For the _Public Key Format_ select _ES256-X509_ option
    * Paste your _public key_ in the space provided
    * Click _create_
* **Note:** Once you would like to discontinue the GCP service, make sure to disable the billing service of your project. Otherwise you may incurr an expensive bill.


## Hardware Setup
* Open Arduino IDE and follow the steps presented in this [tutorial](https://randomnerdtutorials.com/installing-the-esp32-board-in-arduino-ide-windows-instructions/)
* Use the MQTT 3.1.1 libraries
* Follow the steps [this](https://medium.com/@ludovic.emo/how-to-send-esp32-telemetry-to-google-cloud-iot-core-caf1a952020d) guide to send telemetry to GCP
* Read sensors and store them in a payload `data` statement
* Push payload statement onto the cloud

## Validate Data acquisition in GCP
*   The following [article](http://www.opensources.org/receiving-and-storing-sensor-data-with-google-cloud-dataflow-and-cloud-storage/) shows how to print _PubSub_ messages using python. Additionally, the python script can be found in this repository.
* Run the python script in _Cloud shell_, such as `python your-file-name.py`
* Notice the PubSub messages being published in the virtual terminal console

## Generate Report
* Create a BigQuery framework
    * Enable _BigQuery_ in _Cloud Console_
    * Follow [this](https://cloud.google.com/bigquery/docs/) _Google Documentation guideline_
    * From _BigQuery_ console, click on your _project ID_ and select _create a Dataset_
    * Name your _dataset_ freely but keep in mind you will need it repeteadly when querying your data, so nothing too verbose
    * Select the newly created dataset
    * Click on _Create Table_ and give it a name
    * **Note** the schema is tailored to YOUR data and YOUR application
        * So, you want to think about what the schema is.
        * For this project, four (4) data members were used.
            * Three (3) are floats: temp, moisture, and light, and one (1) is a string: time
    * Use _Dataflow_ template to stream MQTT data to database
        * Go to _Dataflow_ in GCP console
        * Click _create job from template_
        * Select _PubSub-to-BigQuery_
        * Fill out the form
        * Run job
        * Observe the table
    * Export to _Google Sheet_
        * Go to _BigQuery_ table
        * Select export
        * Send as CSV


